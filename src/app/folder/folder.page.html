<ion-header [translucent]="true" class="custom-header">
  <ion-toolbar class="custom-toolbar" style="background-color: black;">
    <ion-buttons slot="end">
      <ion-button size="large" [routerLink]="['/perfil-usuario']">
        <ion-icon style="color:  white" name="person-circle-outline"></ion-icon>
      </ion-button>
      <ion-menu-button size="medium"></ion-menu-button>
    </ion-buttons>
    <ion-title style="color:  white">PuntoDuoc</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="content-center">
  <!-- Barra de búsqueda y botón de filtros -->
  <div class="search-container">
    <ion-searchbar style="--background: white; --color: #000000;"
      animated="true"
      placeholder="Buscar eventos"
      [(ngModel)]="searchText"
      (ionInput)="filterEvents()"
      class="custom-searchbar">
    </ion-searchbar>

    <ion-button
      aria-label="Filter"
      class="filter-button"
      style="--background: white; --color: #000000;"
      (click)="toggleFilters()">
      <ion-icon name="options-outline"></ion-icon>
    </ion-button>
  </div>

  <div class="filters-container" [ngClass]="{ 'visible': showFilters }" style="--background: #0A49A7">
    <!-- Aquí agregas las opciones de filtro -->
    <ion-item style="--background: #0A49A7">
      <ion-label>Sede</ion-label>
      <ion-select [(ngModel)]="selectedSede" (ionChange)="filterEvents()">
          <ion-select-option value="all">Todas las sedes</ion-select-option>
          <ion-select-option value="Duoc Alameda">Duoc Alameda</ion-select-option>
          <ion-select-option value="Duoc Antonio Varas">Duoc Antonio Varas</ion-select-option>
          <ion-select-option value="Duoc Maipú">Duoc Maipú</ion-select-option>
          <ion-select-option value="Duoc Plaza Oeste">Duoc Plaza Oeste</ion-select-option>
          <ion-select-option value="Duoc Puente Alto">Duoc Puente Alto</ion-select-option>
          <ion-select-option value="Duoc San Bernardo">Duoc San Bernardo</ion-select-option>
          <ion-select-option value="Duoc San Joaquín">Duoc San Joaquín</ion-select-option>
          <ion-select-option value="Duoc Plaza Vespucio">Duoc Plaza Vespucio</ion-select-option>
          <ion-select-option value="Duoc Viña del Mar">Duoc Viña del Mar</ion-select-option>
          <ion-select-option value="Duoc Valparaíso">Duoc Valparaíso</ion-select-option>
          <ion-select-option value="Duoc Melipilla">Duoc Melipilla</ion-select-option>
          <ion-select-option value="Duoc Renca">Duoc Renca</ion-select-option>
          <ion-select-option value="Duoc Padre Alonso de Ovalle">Duoc Padre Alonso de Ovalle</ion-select-option>
          <ion-select-option value="Duoc Concepción">Duoc Concepción</ion-select-option>
          <ion-select-option value="Duoc San Andrés de Concepción">Duoc San Andrés de Concepción</ion-select-option>
          <ion-select-option value="Duoc Villarrica">Duoc Villarrica</ion-select-option>
      </ion-select>
    </ion-item>
  </div>

  <!-- Cargando -->
  <div *ngIf="loading" class="ion-padding" style="text-align: center;">
    <ion-spinner name="crescent" style="color: white"></ion-spinner>
    <p style="color: white">Cargando...</p>
  </div>

  <!-- Listado de eventos (ocultarlo si loading es verdadero) -->
  <ion-grid *ngIf="!loading">
    <ion-row>
      <ion-col size="12" size-md="6" *ngFor="let event of filteredEvents">
        <ion-card class="event-card">
          <img alt="Imagen del evento" [src]="event.imagen" class="event-image" />
          <ion-card-header>
            <ion-card-title (click)="toggleDescription(event)" class="centered-text" style="color: #0A49A7;">
              {{ event.titulo }}
            </ion-card-title>
          </ion-card-header>

          <ion-card-content class="centered-content">
            <p *ngIf="event.show" style="color: #0A49A7;">{{ event.descripcion }}</p>
            <p style="color: #0A49A7;">Cupos disponibles: {{ event.Cupos }}</p>

            <p *ngIf="event.estaInscrito" class="inscrito-text" style="color: #0A49A7;">
              ¡Ya estás inscrito en este evento!
            </p>
            <p *ngIf="event.enListaEspera" class="en-lista-espera-text" style="color: #0A49A7;">
              ¡Ya estás en la lista de espera!
            </p>
            <p *ngIf="event.Cupos === 0 && !event.enListaEspera" class="lleno-text" style="color: #0A49A7;">
              Este evento está lleno. Puedes unirte a la lista de espera.
            </p>

            <ion-button
              [color]="
                event.estaInscrito
                  ? 'danger'
                  : event.Cupos === 0
                  ? event.enListaEspera
                    ? 'primary'
                    : 'primary'
                  : 'primary'
              "
              (click)="
                event.estaInscrito
                  ? cancelarInscripcion(event.id_evento)
                  : event.enListaEspera
                  ? salirDeListaEspera(event.id_evento)
                  : presentAlert(event)
              "
              expand="block"
              style="--background: #0A49A7; --color: white;">
              {{
                event.estaInscrito
                  ? 'Cancelar inscripción'
                  : event.Cupos === 0
                  ? event.enListaEspera
                    ? 'Salir de lista de espera'
                    : 'Unirse a lista de espera'
                  : 'Inscribirse'
              }}
            </ion-button>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Pie de página -->
  <div class="footer">
    <p>Síguenos en nuestras redes sociales:</p>
    <div class="social-icons">
      <ion-icon name="logo-facebook" class="social-icon"></ion-icon>
      <ion-icon name="logo-twitter" class="social-icon"></ion-icon>
      <ion-icon name="logo-instagram" class="social-icon"></ion-icon>
    </div>
    <p>&copy; 2024 Punto Duoc. Todos los derechos reservados.</p>
  </div>
</ion-content>
